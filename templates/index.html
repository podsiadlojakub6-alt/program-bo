<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Kalkulator BO</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 p-4 md:p-8 font-sans">
    <div class="max-w-4xl mx-auto bg-white rounded-3xl shadow-xl p-8">
        
        <div class="flex border-b mb-8">
            <button onclick="switchTab('natura')" id="btn-natura" class="py-2 px-6 font-black uppercase text-sm border-b-4 transition-all">Gry z Naturą</button>
            <button onclick="switchTab('strategiczne')" id="btn-strategiczne" class="py-2 px-6 font-black uppercase text-sm border-b-4 transition-all">Gry Strategiczne</button>
        </div>

        <form method="POST" id="mainForm">
            <input type="hidden" name="tab" id="tabInput" value="{{ active_tab }}">
            
            <div class="flex justify-between mb-4">
                <h2 id="tabTitle" class="text-xl font-black uppercase italic text-slate-700">Gry z Naturą</h2>
                <div class="flex gap-2">
                    <button type="button" onclick="addRow()" class="bg-emerald-500 text-white px-3 py-1 rounded-lg text-xs font-bold">+ Wiersz</button>
                    <button type="button" onclick="addColumn()" class="bg-emerald-500 text-white px-3 py-1 rounded-lg text-xs font-bold">+ Kolumna</button>
                </div>
            </div>

            <div class="overflow-x-auto mb-6">
                <table class="w-full border-separate border-spacing-2">
                    <tbody id="tableBody">
                        {% if results and results.matrix %}
                            {% for row in results.matrix %}
                            <tr>
                                <td class="font-bold text-slate-400">{% if active_tab == 'natura' %}A{{loop.index}}{% else %}G1-{{loop.index}}{% endif %}</td>
                                {% for cell in row %}
                                <td><input type="text" name="cell_{{loop.parent.index0}}_{{loop.index0}}" class="w-20 p-2 border rounded text-center font-bold" value="{{cell}}"></td>
                                {% endfor %}
                                <td><button type="button" onclick="this.closest('tr').remove()" class="text-rose-400">×</button></td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td class="font-bold text-slate-400">A1</td>
                                <td><input type="text" name="cell_0_0" class="w-20 p-2 border rounded text-center font-bold" value="0"></td>
                                <td><input type="text" name="cell_0_1" class="w-20 p-2 border rounded text-center font-bold" value="0"></td>
                                <td><button type="button" onclick="this.closest('tr').remove()" class="text-rose-400">×</button></td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>

            <div id="gammaContainer" class="mb-6 {% if active_tab == 'strategiczne' %}hidden{% endif %}">
                <label class="text-xs font-black uppercase text-slate-400">Gamma (Hurwicz):</label>
                <input type="number" step="0.1" name="gamma" value="0.6" class="p-2 border rounded w-20 font-bold">
            </div>

            <button type="submit" class="w-full bg-blue-600 text-white py-4 rounded-xl font-black uppercase tracking-widest shadow-lg">Oblicz</button>
        </form>

        {% if results %}
            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4">
                {% if results.type == 'natura' %}
                    <div class="p-4 bg-blue-50 rounded-xl border-l-4 border-blue-500"><p class="text-xs font-bold">WALD: A{{results.wald.idx}} ({{results.wald.val}})</p></div>
                    <div class="p-4 bg-emerald-50 rounded-xl border-l-4 border-emerald-500"><p class="text-xs font-bold">HURWICZ: A{{results.hurwicz.idx}} ({{results.hurwicz.val}})</p></div>
                    <div class="p-4 bg-purple-50 rounded-xl border-l-4 border-purple-500"><p class="text-xs font-bold">BAYES: A{{results.bayes.idx}} ({{results.bayes.val}})</p></div>
                    <div class="p-4 bg-rose-50 rounded-xl border-l-4 border-rose-500"><p class="text-xs font-bold">SAVAGE: A{{results.savage.idx}} ({{results.savage.val}})</p></div>
                {% elif results.type == 'strategiczne' %}
                    <div class="p-4 bg-slate-50 rounded-xl"><p class="text-xs font-bold">WARTOŚĆ DOLNA: {{results.lower}}</p></div>
                    <div class="p-4 bg-slate-50 rounded-xl"><p class="text-xs font-bold">WARTOŚĆ GÓRNA: {{results.upper}}</p></div>
                    <div class="col-span-2 p-4 {% if results.saddle %}bg-emerald-100{% else %}bg-amber-100{% endif %} rounded-xl text-center font-black">
                        {% if results.saddle %} PUNKT SIODŁOWY: {{results.saddle}} {% else %} BRAK PUNKTU SIODŁOWEGO (GRA MIESZANA) {% endif %}
                    </div>
                {% endif %}
            </div>
        {% endif %}
    </div>

    <script>
        function switchTab(tab) {
            document.getElementById('tabInput').value = tab;
            document.getElementById('tabTitle').innerText = tab === 'natura' ? 'Gry z Naturą' : 'Gry Strategiczne';
            document.getElementById('gammaContainer').classList.toggle('hidden', tab === 'strategiczne');
            
            document.getElementById('btn-natura').className = tab === 'natura' ? 'py-2 px-6 font-black uppercase text-sm border-b-4 border-blue-600 text-blue-600' : 'py-2 px-6 font-black uppercase text-sm border-b-4 border-transparent text-slate-400';
            document.getElementById('btn-strategiczne').className = tab === 'strategiczne' ? 'py-2 px-6 font-black uppercase text-sm border-b-4 border-blue-600 text-blue-600' : 'py-2 px-6 font-black uppercase text-sm border-b-4 border-transparent text-slate-400';
        }
        
        function addRow() {
            const body = document.getElementById('tableBody');
            const cols = body.rows[0].cells.length - 2;
            const newRow = body.insertRow();
            const label = activeTab() === 'natura' ? 'A' + body.rows.length : 'G1-' + body.rows.length;
            newRow.innerHTML = `<td class="font-bold text-slate-400">${label}</td>` + 
                '<td><input type="text" class="w-20 p-2 border rounded text-center font-bold" value="0"></td>'.repeat(cols) + 
                '<td><button type="button" onclick="this.closest(\'tr\').remove()" class="text-rose-400">×</button></td>';
            updateInputs();
        }

        function addColumn() {
            const body = document.getElementById('tableBody');
            for(let i=0; i<body.rows.length; i++) {
                const cell = body.rows[i].insertCell(body.rows[i].cells.length - 1);
                cell.innerHTML = '<input type="text" class="w-20 p-2 border rounded text-center font-bold" value="0">';
            }
            updateInputs();
        }

        function updateInputs() {
            const rows = document.getElementById('tableBody').rows;
            for(let i=0; i<rows.length; i++) {
                const inputs = rows[i].querySelectorAll('input');
                inputs.forEach((inp, j) => { inp.name = `cell_${i}_${j}`; });
            }
        }

        function activeTab() { return document.getElementById('tabInput').value; }
        window.onload = () => switchTab('{{ active_tab }}');
    </script>
</body>
</html>
