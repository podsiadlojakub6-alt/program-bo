<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>BO Master Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .input-cell { width: 80px; text-align: center; border: 1px solid #e2e8f0; padding: 6px; border-radius: 8px; }
        .tab-active { border-bottom: 4px solid #2563eb; color: #2563eb; background: #f8fafc; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen p-4">
    <div class="max-w-5xl mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden">
        <div class="flex border-b text-xs font-black uppercase tracking-widest text-slate-400">
            <button onclick="setM('bo')" id="b-bo" class="flex-1 py-5 hover:text-blue-600 transition">Decyzje</button>
            <button onclick="setM('game')" id="b-game" class="flex-1 py-5 hover:text-blue-600 transition">Gry</button>
            <button onclick="setM('transport')" id="b-transport" class="flex-1 py-5 hover:text-blue-600 transition">Transport</button>
            <button onclick="setM('simplex')" id="b-simplex" class="flex-1 py-5 hover:text-blue-600 transition">Simplex</button>
        </div>

        <div class="p-8">
            <form method="POST">
                <input type="hidden" name="mode" id="m" value="{{ mode }}">
                
                <div class="flex justify-between items-center mb-6">
                    <h2 id="t" class="text-2xl font-black text-slate-800">Macierz</h2>
                    <div class="flex gap-2">
                        <button type="button" onclick="aR()" class="bg-emerald-500 text-white px-4 py-2 rounded-xl text-xs font-bold">+ Wiersz</button>
                        <button type="button" onclick="aC()" class="bg-emerald-500 text-white px-4 py-2 rounded-xl text-xs font-bold">+ Kolumna</button>
                    </div>
                </div>

                <div id="hint" class="mb-4 p-3 bg-blue-50 text-blue-700 text-xs rounded-xl border border-blue-100"></div>

                <div class="overflow-x-auto mb-8">
                    <table id="mt" class="w-full">
                        <thead id="th" class="bg-slate-50 text-[10px] font-black uppercase text-slate-400">
                            <tr id="dr"><th></th><th class="p-1"><button type="button" onclick="rC(1)" class="text-rose-500">USUŃ</button></th><th class="p-1"><button type="button" onclick="rC(2)" class="text-rose-500">USUŃ</button></th><th></th></tr>
                            <tr id="hr"><th class="p-3"></th><th class="p-3">Kol 1</th><th class="p-3">Kol 2</th><th></th></tr>
                        </thead>
                        <tbody id="tb" class="divide-y divide-slate-50">
                            <tr><td class="p-4 font-bold text-xs text-slate-500">W1</td><td><input name="cell_0_0" class="input-cell" value="0"></td><td><input name="cell_0_1" class="input-cell" value="0"></td><td class="text-center"><button type="button" onclick="rR(this)" class="text-slate-300 hover:text-rose-500">×</button></td></tr>
                            <tr><td class="p-4 font-bold text-xs text-slate-500">W2</td><td><input name="cell_1_0" class="input-cell" value="0"></td><td><input name="cell_1_1" class="input-cell" value="0"></td><td class="text-center"><button type="button" onclick="rR(this)" class="text-slate-300 hover:text-rose-500">×</button></td></tr>
                        </tbody>
                    </table>
                </div>

                <div id="opts" class="mb-8 p-6 bg-slate-50 rounded-2xl flex items-center gap-4 border border-slate-100">
                    <span class="text-xs font-black uppercase text-slate-500">Gamma (Hurwicz):</span>
                    <input type="number" step="0.1" name="gamma" value="0.6" class="w-20 p-2 border rounded-xl text-center font-bold text-blue-600">
                </div>

                <button type="submit" class="w-full bg-slate-900 text-white font-black py-5 rounded-2xl shadow-xl hover:bg-black transition uppercase tracking-widest">Oblicz Wyniki</button>
            </form>

            {% if results %}
            <div class="mt-10 p-8 bg-slate-900 rounded-3xl text-white shadow-2xl">
                {% if results.error %}<p class="text-rose-400 font-bold">Błąd: {{ results.error }}</p>
                {% elif results.type == 'bo' %}
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                        <div class="p-4 bg-white/5 rounded-2xl">
                            <p class="text-[10px] text-slate-500 uppercase font-bold mb-1">Wald</p>
                            <p class="text-xl font-black">Wariant {{ results.wald }}</p>
                        </div>
                        <div class="p-4 bg-white/5 rounded-2xl">
                            <p class="text-[10px] text-slate-500 uppercase font-bold mb-1">Hurwicz</p>
                            <p class="text-xl font-black">Wariant {{ results.hur }}</p>
                        </div>
                        <div class="p-4 bg-white/5 rounded-2xl">
                            <p class="text-[10px] text-slate-500 uppercase font-bold mb-1">Bayes</p>
                            <p class="text-xl font-black">Wariant {{ results.bayes }}</p>
                        </div>
                        <div class="p-4 bg-white/5 rounded-2xl">
                            <p class="text-[10px] text-slate-500 uppercase font-bold mb-1">Savage</p>
                            <p class="text-xl font-black">Wariant {{ results.sav }}</p>
                        </div>
                    </div>
                {% elif results.type == 'game' %}
                    <div class="space-y-4">
                        <p class="text-emerald-400 font-bold">Maximin: {{results.data.maximin}} | Minimax: {{results.data.minimax}}</p>
                        {% if results.data.saddle %}<p class="text-2xl font-black">Punkt Siodłowy: V = {{results.data.saddle.v}}</p><p class="text-xs text-slate-400">Strategia: W{{results.data.saddle.r}}, K{{results.data.saddle.c}}</p>
                        {% elif results.data.mixed %}<p class="text-xl font-bold text-blue-400">Strategie Mieszane 2x2:</p><p>P = ({{results.data.mixed.p1}}, {{results.data.mixed.p2}}) | Q = ({{results.data.mixed.q1}}, {{results.data.mixed.q2}}) | V = {{results.data.mixed.v}}</p>
                        {% else %}<p class="text-rose-400">Brak punktu siodłowego. Macierz > 2x2.</p>{% endif %}
                    </div>
                {% elif results.type == 'trans' %}
                    <p class="text-emerald-400 text-3xl font-black italic mb-4">Całkowity Koszt: {{ results.data.cost }}</p>
                    <div class="text-xs text-slate-400 uppercase font-bold">Rozdysponowanie:</div>
                    <pre class="text-blue-300 mt-2 font-mono">{{ results.data.allocation }}</pre>
                {% elif results.type == 'simplex' %}
                    <p class="text-blue-400 text-3xl font-black italic mb-4">Max Z = {{ results.data.obj }}</p>
                    <p class="text-sm font-bold uppercase tracking-widest text-slate-500">Zmienne decyzyjne:</p>
                    <div class="flex gap-4 mt-2">{% for val in results.data.x %}<div class="bg-white/10 px-4 py-2 rounded-lg font-mono">X{{loop.index}} = {{val}}</div>{% endfor %}</div>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        const hints = {
            bo: "Decyzje: Wpisz macierz zysków (Warianty x Stany).",
            game: "Teoria Gier: Macierz gry o sumie zerowej.",
            transport: "Transport: Ostatnia kolumna to PODAŻ, ostatni wiersz to POPYT. Środek to koszty.",
            simplex: "Simplex: Ostatni wiersz to FUNKCJA CELU, ostatnia kolumna to OGRANICZENIA (Prawa strona)."
        };

        function setM(m) {
            document.getElementById('m').value = m;
            document.getElementById('t').innerText = m.toUpperCase();
            document.getElementById('hint').innerText = hints[m];
            document.getElementById('opts').style.display = (m === 'bo') ? 'flex' : 'none';
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('tab-active'));
            document.getElementById('b-' + m).classList.add('tab-active');
            uN();
        }
        setM('{{mode}}' || 'bo');

        function uN() {
            const m = document.getElementById('m').value;
            const rows = document.querySelectorAll('#tb tr');
            rows.forEach((r, i) => {
                let label = 'W' + (i + 1);
                if (m === 'transport' && i === rows.length - 1) label = 'POPYT';
                if (m === 'simplex' && i === rows.length - 1) label = 'F.CELU';
                r.cells[0].innerText = label;
                r.querySelectorAll('input').forEach((n, j) => n.name = `cell_${i}_${j}`);
            });
            const heads = document.querySelectorAll('#hr th');
            for (let i = 1; i < heads.length - 1; i++) {
                let label = 'Kol ' + i;
                if (m === 'transport' && i === heads.length - 2) label = 'PODAŻ';
                if (m === 'simplex' && i === heads.length - 2) label = 'LIMIT';
                heads[i].innerText = label;
            }
        }

        function aR() {
            const b = document.getElementById('tb'), c = document.getElementById('hr').cells.length - 2, r = document.createElement('tr');
            let s = `<td class="p-4 font-bold text-xs text-slate-500"></td>`;
            for (let i = 0; i < c; i++) s += `<td><input class="input-cell" value="0"></td>`;
            s += `<td class="text-center"><button type="button" onclick="rR(this)" class="text-slate-300 hover:text-rose-500">×</button></td>`;
            r.innerHTML = s; b.appendChild(r); uN();
        }

        function aC() {
            const dr = document.getElementById('dr'), hr = document.getElementById('hr'), rows = document.querySelectorAll('#tb tr');
            const nI = hr.cells.length - 1;
            const thD = document.createElement('th'); thD.className = "p-1"; thD.innerHTML = `<button type="button" onclick="rC(${nI})" class="text-rose-500">USUŃ</button>`;
            dr.insertBefore(thD, dr.lastElementChild);
            const thH = document.createElement('th'); thH.className = "p-3";
            hr.insertBefore(thH, hr.lastElementChild);
            rows.forEach(r => {
                const td = document.createElement('td'); td.innerHTML = `<input class="input-cell" value="0">`;
                r.insertBefore(td, r.lastElementChild);
            });
            uN();
        }

        function rR(b) { if (document.querySelectorAll('#tb tr').length > 1) { b.closest('tr').remove(); uN(); } }
        function rC(i) {
            const dr = document.getElementById('dr'), hr = document.getElementById('hr'), rows = document.querySelectorAll('#tb tr');
            if (hr.cells.length > 3) {
                dr.deleteCell(i); hr.deleteCell(i); rows.forEach(r => r.deleteCell(i));
                dr.querySelectorAll('button').forEach((b, idx) => b.setAttribute('onclick', `rC(${idx + 1})`));
                uN();
            }
        }
    </script>
</body>
</html>
